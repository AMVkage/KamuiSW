function initdictation(){return"SpeechSynthesisUtterance"in window?(utt=new SpeechSynthesisUtterance,!0):!1}function initrecogn(){return"webkitSpeechRecognition"in window?(recognition=new webkitSpeechRecognition,recognition.onend=function(){stopme()},recognition.onresult=function(e){for(var t="",n=e.resultIndex;n<e.results.length;++n){if(e.results[n].isFinal){for(txtalter.value+="i="+n+" final="+e.results[n].isFinal+" time="+(Date.now()-timestart)+"\n",j=0;j<e.results[n].length;j++)txtalter.value+=e.results[n][j].transcript+"   "+e.results[n][j].confidence+"\n";txtalter.value+="\n"}e.results[n].isFinal?final_transcript+=e.results[n][0].transcript:t+=e.results[n][0].transcript}recognition.continuous&&recognition.interimResults?txtrecogn.value=final_transcript+t:txtrecogn.value=final_transcript},!0):!1}function removeOptions(e){var t;for(t=e.options.length-1;t>=0;t--)e.remove(t)}function fillselvoices(){var e=speechSynthesis.getVoices();removeOptions(selvoices);for(var t=0;t<e.length;t++){var n=document.createElement("option");n.text=e[t].name,selvoices.add(n)}selvoices.selectedIndex=2}function handleFiles(e){var t=window.URL.createObjectURL(e[0]);document.getElementById("mediaid").src=t}function issoundready(){return void 0!=javascriptNode&&null!=javascriptNode.onaudioprocess?!0:!1}function changesound(){issoundready()||turnsound()}function turnsound(){try{audioContext||(audioContext=new AudioContext)}catch(e){return alert("Web Audio API is not supported in this browser"),!1}try{navigator.getMedia({audio:!0},setupAudioNodes,onError)}catch(e){return alert("GetUserMedia threw exception :"+e),!1}return!0}function initsound(){return navigator.getMedia=navigator.mozGetUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,navigator.getMedia?!0:!1}function showtime(){txtrectime.value=parseInt(txtrectime.value)+1,txtrectime.value>=parseInt(txttimemax.value)&&(clearInterval(timerid),timerid=0,stopme())}function speakme(){var e=speechSynthesis.getVoices();utt.voice=e.filter(function(e){return e.name==selvoices.options[selvoices.selectedIndex].value})[0],utt.text=txtspeak.value,utt.rate=ttsrange.value,speechSynthesis.speak(utt)}function togglebut(){"orange"==recordbtn.style.backgroundColor?stopme():startme()}function startme(){if(recordbtn.style.backgroundColor="orange",recordbtn.value="Stop recording",!timerid){if(chksound.checked&&turnsound(),!chksound.checked&&!chkrecogn.checked)return void alert("please, check at least one of the  options (recording or recognition)");chkrecogn.checked&&(recognition.lang=sellang.options[sellang.selectedIndex].value,recognition.maxAlternatives=txtmaxalt.value,recognition.continuous=!0,recognition.interimResults=!0,recognition.start()),timestart=Date.now(),reset(),txtrectime.value=0,timerid=setInterval(showtime,1e3)}}function stopme(){recordbtn.style.backgroundColor="",recordbtn.value="Start recording",timerid&&(clearInterval(timerid),timerid=0),recognition.stop(),issoundready()&&disable()}function playme(){stopme(),playRecording(),stopme()}function reset(){recording=null,txtrecogn.value="",txtalter.value="",final_transcript=""}function disable(){javascriptNode.onaudioprocess=null,audioStream&&audioStream.getAudioTracks()[0].stop(),sourceNode&&sourceNode.disconnect()}function onError(e){console.log(e)}function addSampleToRecording(e){var t=e.getChannelData(0);if(null==recording)recording=t;else{newlen=recording.length+t.length;var n=new Float32Array(newlen);n.set(recording,0),n.set(t,recording.length),recording=n}}function playRecording(){null!=recording&&(audioBuffer=audioContext.createBuffer(1,recording.length,audioContext.sampleRate),audioBuffer.getChannelData(0).set(recording,0),audioBufferNode=audioContext.createBufferSource(),audioBufferNode.buffer=audioBuffer,audioBufferNode.connect(audioContext.destination),audioBufferNode.start(0))}function setupAudioNodes(e){var t=1024;audioStream=e,sourceNode=audioContext.createMediaStreamSource(audioStream),javascriptNode=audioContext.createScriptProcessor(t,1,1),sourceNode.connect(javascriptNode),javascriptNode.connect(audioContext.destination),javascriptNode.onaudioprocess=function(e){addSampleToRecording(e.inputBuffer)}}function diffme(){var e=txtspeak.value,t=txtrecogn.value;e=cleartxt(e),t=cleartxt(t);var n=e.split(" "),o=t.split(" ");diff(o,n,5,e);var r=document.getElementById("diftxt").offsetTop;window.scrollTo(0,r)}function cleartxt(e){var t=e.replace(/[.,!?;":\(\)]/g," "),t=t.replace(/\s{2,}/g," "),t=t.trim();return t}function diff(e,t,n,o){var r,i,a=document.getElementById("diftxt"),c="",s=e.length,d=t.length,u=0,l=0,g=!1;for(r=0;s>r;r++){for(g=!1,i=0;n>i;i++){if(d>u+i&&e[r].toLowerCase()==t[u+i].toLowerCase()){g=!0,u+=i,l++;break}if(u-i>=0&&e[r].toLowerCase()==t[u-i].toLowerCase()){g=!0,u-=i,l++;break}}c+=g?'<span class="green">'+e[r]+"</span> ":'<span class="red">'+e[r]+"</span> ",d>u+n&&u++}a.innerHTML=o+"<br><br>"+c+"<br><br>Percent of recognized words - "+Math.round(100*l/s)+"%"}function changerate(){document.getElementById("mediaid").playbackRate=ttsrange.value}var audioContext,sourceNode,javascriptNode,array=[],recording=null,audioBufferNode=null,audioBuffer=null,isload=!1,txtrectime,timerid,txtspeak,txtrecogn,txtmaxalt,chksound,chkrecogn,selvoices,recognition,utt,final_transcript="",txttimemax,txtalter,timestart,btnspeak,btnstart,bntplay,recordbtn;window.onload=function(){var e=0;txtrectime=document.getElementById("txtrectime"),txtspeak=document.getElementById("txtspeak"),txtrecogn=document.getElementById("txtrecogn"),chksound=document.getElementById("chksound"),chkrecogn=document.getElementById("chkrecogn"),txttimemax=document.getElementById("txttimemax"),txtalter=document.getElementById("txtalter"),selvoices=document.getElementById("selvoices"),txtmaxalt=document.getElementById("txtmaxalt"),btnspeak=document.getElementById("btnspeak"),btnplay=document.getElementById("btnplay"),recordbtn=document.getElementById("recordbtn"),ttsrange=document.getElementById("ttsrange"),initsound()||(chksound.checked="",chksound.disabled=!0,btnplay.disabled=!0,e++),initdictation()?(fillselvoices(),setTimeout(fillselvoices,3e3)):btnspeak.disabled=!0,initrecogn()||(chkrecogn.checked="",chkrecogn.disabled=!0,e++),2==e&&(recordbtn.disabled=!0)};